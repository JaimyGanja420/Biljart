<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Tryout Project</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				width: 100%;
				height: 100%;
			}
		</style>
	</head>
	<body>


		<script src="js/three.min.js"></script>
		<script src="js/ball.js"></script>
        <script src="js/OrbitControls.js"></script>

		<script>

			//Variables
			var wBSX = -0.8;
			var wBSZ = -0.5;

			var r1BSX = 0.5;
            var r1BSZ = 0.7;


			//Scene setup
			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
			var renderer = new THREE.WebGLRenderer();
			renderer.setSize(window.innerWidth, window.innerHeight);
			renderer.setClearColor(0x000000);
			document.body.appendChild(renderer.domElement);

			//Camera positioning
			camera.position.z = 20;
			camera.position.y = 20;

			//Orbit controls
			var controls = new THREE.OrbitControls(camera);
			controls.addEventListener('change');

			//Objects
            var loader = new THREE.ObjectLoader();
            loader.load('models/scene.json', function(tafel){
                scene.add(tafel);
            });

			var groundMaterial = new THREE.MeshPhongMaterial( { color: 0xffffff } );
			var ground = new THREE.Mesh( new THREE.PlaneBufferGeometry(100,100,2,2), groundMaterial);
			ground.position.y = -2;
			ground.rotation.x = - Math.PI / 2;
			scene.add(ground);

			scene.add( new THREE.AmbientLight(0x111111));

			var whiteBall = whiteSphere;
            whiteBall.position.y = 0.5;
			scene.add(whiteBall);

            var redBall1 = redSphere;
            redBall1.position.y = 0.5;
            redBall1.position.x = 2.5;
            scene.add(redBall1);

            //BoundigBoxes Init
            var whiteBox = new THREE.BoundingBoxHelper(whiteBall, 0x00ff00);
            var redBox = new THREE.BoundingBoxHelper(redBall1,0x00ff0f);

			redBall1.speedx = r1BSX;
			redBall1.speedz = r1BSZ;

			//Renderer
			function render() {
			    //Render init
				requestAnimationFrame(render);
				renderer.render(scene, camera);

				//Check if collision has happend
                //if (redBox.box.isIntersectionBox(whiteBox.box)) alert("They have hit!");
                if (redBox.box.isIntersectionBox(whiteBox.box)){
                	alert(whiteBall.speedx);
                    tempx = wBSX;
                    wBSX = r1BSX;
                    r1BSX = tempx;

                    tempz = wBSZ;
                    wBSZ = r1BSZ;
                    r1BSZ = tempz;
                }

                //Ball speed vectors
                whiteBall.position.x += wBSX;
				whiteBall.position.z += wBSZ;

                redBall1.position.x += r1BSX;
                redBall1.position.z += r1BSZ;

				//Playtable Border physics
                if(whiteBall.position.x >= 6.5 || whiteBall.position.x <= -6.5){
                    wBSX *= -1;
                }

				if(whiteBall.position.z >= 11.75 || whiteBall.position.z <= -11.75){
					wBSZ *= -1;
				}

                if(redBall1.position.x >= 6.5 || redBall1.position.x <= -6.5){
                    r1BSX *= -1;
                }

                if(redBall1.position.z >= 11.75 || redBall1.position.z <= -11.75){
                    r1BSZ *= -1;
                }

                //Slow down physics
                if(wBSX > 0 || wBSZ > 0){
                	wBSX *= 0.980;
					wBSZ *= 0.980;
				}

				if(r1BSX > 0 || r1BSZ > 0){
					r1BSX *= 0.980;
					r1BSZ *= 0.980;
				}



				//Keep bounding boxes updated
                whiteBox.update();
                redBox.update();

			}
			render();
		</script>
	</body>
</html>
